{"version":3,"names":["Room","Track","registerGlobals","TrackVolumeVisualizer","Api","RealtimeSessionEngine","agentParticipant","agentTrack","_microphoneEnabledState","transcriptions","_agentState","_remainingSeconds","id","constructor","onConnectionStateChanged","onMessagesChanged","onMicrophoneChanged","onAgentVolumeChanged","onUserVolumeChanged","onAgentStateChanged","onRemainingSecondsChanged","onAgentError","onCanPlayAudioChanged","livekitRoom","on","onRoomConnected","bind","onRoomDisconnected","onTrackSubscribed","onTrackUnsubscribed","onDataReceived","onParticipantMetadataChanged","onLocalTrackPublished","onLocalTrackUnpublished","onTrackMuted","onTrackUnmuted","onAudioPlaybackChangaed","agentVolumeVisualizer","onTick","bands","userVolumeVisualizer","connect","opts","connectionDetails","undefined","connection_details","api","token","res","realtime","startRealtimeSession","url","data","Error","autoSubscribe","canPlaybackAudio","disconnect","startAudio","e","console","error","setMicrophoneEnabled","enabled","localParticipant","sendChatMessage","text","te","TextEncoder","encoded","encode","JSON","stringify","publishData","topic","agentState","value","remainingSeconds","destroy","removeAllListeners","microphoneEnabledState","resolveMicrophoneState","isMicrophoneEnabled","publication","participant","log","isLocal","kind","Kind","Audio","setTrack","audioTrack","_","metadataString","metadata","parse","track","pub","attachedElements","forEach","el","remove","state","decoded","TextDecoder","decode","message","i","length","agent","push","payload","isAgent","md","remaining_seconds","agent_state"],"sourceRoot":"../../../src","sources":["lib/session.ts"],"mappings":"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","ignoreList":[]}
